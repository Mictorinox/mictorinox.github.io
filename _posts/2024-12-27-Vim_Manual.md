---
title: Vim 操作指南
date: 2024-12-27 22:40
categories: 编程实践
tags: mit-missing-semester     # TAG 名称应始终小写
---

通常学习使用一个编辑器包含以下步骤：
1. 阅读教程
2. 坚持使用它完成所有编辑工作
3. 随时查阅
累计使用新编辑器20个小时后，应该可以达到和老编辑器一样快；在此之后新编辑器将大大节省时间

Vim是最流行的基于命令行的代码编辑器，始于1976年
Vim有很多聪明的设计思想，因此值得学习

### Vim的哲学

Vim是一个多模式编辑器，有normal insert visual comman-line 四个模式，
Vim的接口本身也是程序语言，键入操作是命令
Vim避免了使用鼠标，甚至可以避免使用上下左右键

### 编辑模式

正常模式：在文件中移动光标并进行修改
插入模式：插入文本
替换模式：替换文本
可视化模式：选中文本块
命令模式：执行命令

不同模式下键盘输入的含义不同

按下 `<ESC>`可以从任何其他模式返回正常模式。在正常模式，键入 `i` 进入插入 模式，`R` 进入替换模式，`v` 进入可视（一般）模式，`V` 进入可视（行）模式，`<C-v>` （Ctrl-V, 有时也写作 `^V`）进入可视（块）模式，`:` 进入命令模式。

### 基本操作

#### 插入文本

正常模式键入`i` 进入插入模式

#### 缓存、标签页、窗口

Vim会维护一系列打开的文件，称为缓存；
一个Vim会话包含一系列标签页，每个标签页包含一系列窗口。每个窗口显示一个缓存。

#### 命令行

正常模式键入`:` 进入命令行模式
`:q` 退出（关闭窗口）
`:w` 保存（写）
`:wq` 保存然后退出
`:e {文件名}` 打开要编辑的文件
`:ls` 显示打开的缓存
`:help {标题}` 打开帮助文档
    `:help :w` 打开 `:w` 命令的帮助文档
    `:help w` 打开 `w` 移动的帮助文档

### Vim的接口是一种编程语言

Vim的界面本身是一个程序语言，键入操作本身是命令，可以组合使用。
#### 移动

移动（motion）命令也被称为“名词”，因为他们指向文字块

基本移动: `hjkl` （左， 下， 上， 右）
词： `w` （下一个词）， `b` （词初）， `e` （词尾）
行： `0` （行初）， `^` （第一个非空格字符）， `$` （行尾） 
屏幕： `H` （屏幕首行）， `M` （屏幕中间）， `L` （屏幕底部）
翻页： `Ctrl-u` （上翻）， `Ctrl-d` （下翻）
文件： `gg` （文件头）， `G` （文件尾）
行数： `:{行数}<CR>` 或者 `{行数}G` ({行数}为行数)
杂项： `%` （找到配对，比如括号或者 `/* */` 之类的注释对）
查找： `f{字符}`， `t{字符}`， `F{字符}`， `T{字符}`
	查找/到 向前/向后 在本行的{字符}
	`,` / `;` 用于导航匹配
搜索: `/{正则表达式}`, `n` / `N` 用于导航匹配

`Ctrl+G` 显示当前位置，`行号+G` 跳转到指定行号，`Ctrl+O`返回前一个位置，`Ctrl+i`返回后一个位置
#### 选择

进入可视化模式，使用移动命令选中
可视化：`v`
可视化行：`V`
可视化块：`Ctrl`+`v`

#### 编辑

编辑命令也被称为”动词“，可以作用于移动命令（”名词“）

`i` 进入插入模式
    - 但是对于操纵/编辑文本，不单想用退格键完成
`O` / `o` 在之上/之下插入行
`d{移动命令}` 删除 {移动命令}
	例如，`dw` 删除词, `d$` 删除到行尾, `d0` 删除到行头。
`c{移动命令}` 改变 {移动命令}
    例如，`cw` 改变词
    比如 `d{移动命令}` 再 `i`
`x` 删除字符（等同于 `dl`）
`s` 替换字符（等同于 `xi`）
可视化模式 + 操作
    选中文字, `d` 删除 或者 `c` 改变 
`u` 撤销, `<C-r>` 重做
`y` 复制 / “yank” （其他一些命令比如 `d` 也会复制）
`p` 粘贴
更多值得学习的: 比如 `~` 改变字符的大小写


#### 计数

可以用计数结合”名词“和”动词“，会执行指定操作若干次

#### 修饰语

修饰语可以改变”名词“的意义，修饰语有 `i` 表示在内部，`a` 表示在周围
例如 `ci(` 改变当前括号内的内容

### 高级用法
#### 搜索和替换

`:s` 命令替换单行内的第一个结果，前缀`%` 替换整个文件内的结果，后缀`/g` 替换全部结果。例如：
	`%s/str1/str2/g` 将整个文件内的`str1`替换为`str2`

#### 宏

`q{字符}` 来开始在寄存器 `{字符}` 中录制宏
`q` 停止录制
`@{字符}` 重放宏
宏的执行遇错误会停止
 `{计数}@{字符}` 执行一个宏{计数}次
 宏可以递归
    首先用 `q{字符}q` 清除宏
    录制该宏，用 `@{字符}` 来递归调用该宏 （在录制完成之前不会有任何操作）

### 自定义

#### 修改配置

通过修改`~/.vimrc`自定义 Vim 的初始设置
`set nu` /`set number` 添加行号
`set releativenumber` 添加相对行号（光标所在行显示真实行号，其他行显示相对行号，方便跳转）

`set ignorecase` 让搜索对大小写不敏感
`set smartcase` 如果搜索字符串有大写字母，则大小写敏感

`set incsearch` / `set is` 搜索结果
`set hlsearch` / `set hls` 高亮搜索结果（不实用，因为容易找不见光标）
####  扩展Vim
从 Vim 8.0 开始可以使用内置的插件管理系统。只需要创建一个 `~/.vim/pack/vendor/start/` 的文件夹

 [ctrlp.vim](https://github.com/ctrlpvim/ctrlp.vim): 模糊文件查找
  [ack.vim](https://github.com/mileszs/ack.vim): 代码搜索
 [nerdtree](https://github.com/scrooloose/nerdtree): 文件浏览器
 [vim-easymotion](https://github.com/easymotion/vim-easymotion): 魔术操作

可以查看讲师们的开源的配置文件 ([Anish](https://github.com/anishathalye/dotfiles), [Jon](https://github.com/jonhoo/configs) (使用了 [neovim](https://github.com/JJGO/dotfiles/blob/master/vim/.vimrc)), [Jose](https://github.com/JJGO/dotfiles)) 。 浏览 [Vim Awesome](https://vimawesome.com/) 来了解一些很棒的插件。 这个话题也有很多博客文章：搜索 “best Vim plugins”。

